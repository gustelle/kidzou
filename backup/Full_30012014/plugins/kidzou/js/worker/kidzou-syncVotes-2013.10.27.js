function messageHandler(a){switch(a.data.cmd){case"refreshVotesCount":refreshVotesCount(a.data);break;case"syncVotes":syncVotes(a.data);break;case"stop":self.close();break;default:self.postMessage("Unknown command")}}function refreshVotesCount(a){getVotesCount(JSON.parse(a.votesData.posts_in),{API_VOTES_STATUS_URL:a.API_VOTES_STATUS_URL})}function syncVotes(a){diffVotes(JSON.parse(a.votesData.localVotes),JSON.parse(a.votesData.posts_in),a.votesData.user_hash,{API_USERVOTES_URL:a.API_USERVOTES_URL})}function getVotesCount(a,b){var c=new XMLHttpRequest;c.open("GET",b.API_VOTES_STATUS_URL+"?posts_in="+JSON.stringify(a),!1),c.setRequestHeader("Content-Type","application/json;  charset=utf-8"),c.onreadystatechange=function(){4==c.readyState&&200==c.status&&self.postMessage({cmd:"setVotesCount",response:JSON.parse(c.responseText)})},c.send(null)}function diffVotes(a,b,c,d){if(null===a||0===a.length){self.postMessage("localVotes null"),null===c&&(c="");var e=new XMLHttpRequest;e.open("GET",d.API_USERVOTES_URL+"?posts_in="+JSON.stringify(b)+"&user_hash="+c,!1),e.setRequestHeader("Content-Type","application/json;  charset=utf-8"),e.onreadystatechange=function(){4==e.readyState&&200==e.status&&self.postMessage({cmd:"storeLocalVotes",response:JSON.parse(e.responseText)})},e.send(null)}else self.postMessage({cmd:"mapLocalVotes",response:a})}this.addEventListener("message",messageHandler,!1);