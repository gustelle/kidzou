function fbs_click(){return u=location.href,t=document.title,window.open("http://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(u)+"&t="+encodeURIComponent(t),"Partager Kidzou sur Facebook"),!1}var kidzouActions=function(){jQuery("#searchform").submit(function(){kidzouTracker.trackEvent("Recherche","Submit",jQuery("#searchinput").val(),0)}),jQuery(".slide_wrap a").click(function(){kidzouTracker.trackEvent("Featured Slider","Click",jQuery(this).attr("href"),0)}),jQuery("#menu-menu-principal li a").click(function(){kidzouTracker.trackEvent("Navigation","Menu Desktop",jQuery(this).find(".main_text").text(),0)}),jQuery("#mobile_menu li a").click(function(){kidzouTracker.trackEvent("Navigation","Menu Mobile",jQuery(this).find("span").text(),0)}),jQuery("#menu-menu-principal li .dropdown_5columns .col_5 article").click(function(){kidzouTracker.trackEvent("Navigation","MegaDropDown Article",jQuery(this).find(".entry-title a").text(),0)}),jQuery("#menu-menu-principal li .dropdown_5columns .col_3 li a").click(function(){kidzouTracker.trackEvent("Navigation","MegaDropDown Categorie",jQuery(this).text(),0)}),jQuery(".meta a").click(function(){kidzouTracker.trackEvent("Navigation","Meta",jQuery(this).text(),0)}),jQuery(".social.google").click(function(){kidzouTracker.trackEvent("Connexion","Google","LoginDialog",0)}),jQuery(".social.facebook").click(function(){kidzouTracker.trackEvent("Connexion","Facebook","LoginDialog",0)}),jQuery(".catad").click(function(){kidzouTracker.trackEvent("Publicite","Categorie",jQuery(this).attr("src"),0)}),jQuery("#mc-embedded-subscribe-form").submit(function(){kidzouTracker.trackEvent("Newsletter","Inscription","",0)}),jQuery(".rubriques > ul.nav > li").hover(function(){jQuery(this).children().show()},function(){jQuery(this).children(".dropdown_5columns").hide()})}(),_do_track=!kidzou_commons_jsvars.is_admin&&"www.kidzou.fr"===location.hostname;_do_track&&(!function(a,b,c,d,e,f,g){a.GoogleAnalyticsObject=e,a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date,f=b.createElement(c),g=b.getElementsByTagName(c)[0],f.async=1,f.src=d,g.parentNode.insertBefore(f,g)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-23017523-1","kidzou.fr"),ga("send","pageview"));var kidzouTracker=function(){function a(a,b,c,d){_do_track?ga("send","event",a,b,c,d):console.debug("trackEvent("+a+", "+b+", "+c+", "+d+")")}return{trackEvent:a}}(),kidzouMessage=function(){function a(){var a=this;a.messageClass=ko.observable(""),a.messageContent=ko.observable(""),a.addMessage=function(b,c){a.messageClass(b),a.messageContent(c),jQuery("#messageBox").show()},a.removeMessage=function(){a.messageContent(""),jQuery("#messageBox").hide()}}return{message:a}}(),storageSupport=function(){function a(a){k=a}function b(a){if(!e()||!k)return null;var b=localStorage.getCacheItem(a);return null===b?null:JSON.parse(b)}function c(a,b){e()&&k&&null!==b&&null!==a&&""!==a&&localStorage.setCacheItem(a,ko.toJSON(ko.mapping.toJS(b)),{days:30})}function d(a){if(e())try{localStorage.setCacheItem(a,"",{days:0}),localStorage.getCacheItem(a),localStorage.removeItem(a)}catch(b){}else j(a)}function e(){return"undefined"!=typeof Storage?!0:!1}function f(a,b){e()?localStorage.setItem(a,b):h(a,b)}function g(a){return e()?localStorage.getItem(a):void i(a)}function h(a,b){l(a,b,{path:"/",expires:180})}function i(a){return l(a)}function j(a){e()?localStorage.removeItem(a):l(a,null,{path:"/",expires:-1})}var k=!1,l=function(a,b,c){if("undefined"==typeof b){for(var d,e,f=document.cookie.split(";"),g=0;g<f.length;g++)if(d=jQuery.trim(f[g].substr(0,f[g].indexOf("="))),e=f[g].substr(f[g].indexOf("=")+1),d===a)return unescape(e)}else{if(c=c||{},b?b=escape(b):(b="",c.expires=-365),c.expires){var h=new Date;h.setDate(h.getDate()+c.expires),b+="; expires="+h.toUTCString()}c.domain&&(b+="; domain="+c.domain),c.path&&(b+="; path="+c.path),document.cookie=a+"="+b}};return{setLocalSupport:a,setLocal:f,getLocal:g,removeLocal:j,toLocalData:c,fromLocalData:b,removeLocalData:d,setCookie:h,getCookie:i}}(),kidzouModule=function(){String.prototype.toBoolean=function(){switch(this.toLowerCase()){case"true":case"yes":case"1":return!0;case"false":case"no":case"0":case null:return!1;default:return Boolean(this)}};var a=function(){function a(a){d=a.toBoolean()}function b(a){d&&console.debug(a)}function c(a){d&&console.log(a)}var d=!1;return{setLogging:a,debug:b,info:c}}(),b=function(){function b(b){a.debug("mapVotedToVotables "+ko.toJSON(b)),ko.utils.arrayForEach(b,function(a){ko.utils.arrayFirst(n.votableItems,function(b){b.id==a.id&&b.voted(!0)})})}function c(){jQuery.getJSON(kidzou_commons_jsvars.api_get_votes_status,{posts_in:ko.toJSON(n.votableIds)},function(a){d(a.status)})}function d(a){ko.utils.arrayMap(a,function(a){var b=ko.utils.arrayFirst(n.votableItems,function(b){return b.id==a.id?b:void 0});null!==b&&b.votes(a.votes)})}function e(){var c=JSON.parse(storageSupport.getLocal("voted")),d=g();null===c||0===c.length?(a.debug("localVotes null pour user_hash "+d),(null===d||"undefined"===d)&&(d=""),jQuery.getJSON(kidzou_commons_jsvars.api_get_votes_user,{user_hash:g()}).done(function(c){a.debug("storeLocalVotes "+ko.toJSON(c)),null!==c&&null!==c.user_hash&&"undefined"!==c.user_hash&&f(c.user_hash),null!==c&&null!==c.voted&&c.voted.length>0&&(storageSupport.toLocalData("voted",c.voted),b(c.voted))})):b(c)}function f(b){null!==b&&""!==b&&"undefined"!==b&&(null===g()||""===g()||"undefined"===g())&&(a.debug("setUserHash : "+b),storageSupport.setLocal("user_hash",b))}function g(){return"undefined"===storageSupport.getLocal("user_hash")&&(a.debug("user_hash undefined"),storageSupport.removeLocal("user_hash")),storageSupport.getLocal("user_hash")}function h(){ko.utils.arrayMap(jQuery(".votable"),function(a){n.votableIds.push(jQuery(a).data("post")),n.votableItems.push(new j(jQuery(a).data("post"),0,!1))}),c(),e()}function i(){var a=this;a.votableIds=[],a.votableItems=[],a.getVotableItem=function(b){return ko.utils.arrayFirst(a.votableItems,function(a){return a.id==b?a:void 0})}}function j(b,c,d){var e=this;e.id=b,e.votes=ko.observable(c),e.voted=ko.observable(d),e.downActivated=ko.observable(!1),e.countText=ko.computed(function(){return e.downActivated()?kidzou_commons_jsvars.votable_countText_down:kidzou_commons_jsvars.votable_countText}),e.iconClass=ko.computed(function(){return e.voted()?"icon-alreadyvoted":"icon-heart"}),e.activateDown=function(){e.voted()&&e.downActivated(!0)},e.doUpOrDown=function(){e.voted()?e.doWithdraw():e.doVote()},e.deactivateDown=function(){e.downActivated(!1)},e.doVote=function(){if(a.debug("doVote"),!this.voted()){var b=this.id,c=parseInt(this.votes())+1;this.voted(!0),this.votes(c),a.info("doVote "+b+"(+1)"),jQuery.getJSON(kidzou_commons_jsvars.api_get_nonce,{controller:"vote",method:"up"}).done(function(c){if(a.debug("doVote "+ko.toJSON(c)),null!==c){var d=c.nonce;jQuery.getJSON(kidzou_commons_jsvars.api_vote_up,{post_id:b,nonce:d,user_hash:g()},function(b){null!==b.user_hash&&"undefined"!==b.user_hash&&f(b.user_hash),storageSupport.removeLocalData("voted"),a.debug("doVote executed")})}})}},e.doWithdraw=function(){if(this.voted()){var b=this.id,c=parseInt(this.votes())-1;this.voted(!1),this.votes(c),a.info("doWithdraw "+b+"(-1)"),jQuery.getJSON(kidzou_commons_jsvars.api_get_nonce,{controller:"vote",method:"down"}).done(function(c){var d=c.nonce;jQuery.getJSON(kidzou_commons_jsvars.api_vote_down,{post_id:b,nonce:d,user_hash:g()},function(b){null!==b.user_hash&&"undefined"!==b.user_hash&&f(b.user_hash),storageSupport.removeLocalData("voted"),a.debug("doWithdraw executed")})})}}}function k(){ko.applyBindings(l())}function l(){return{message:m,votes:n}}var m=new kidzouMessage.message,n=new i;return h(),{bindView:k}}(),c=function(){function a(){"none"===jQuery("#mobile_nav").css("display")?(vex.defaultOptions.contentClassName="",vex.defaultOptions.className="vex-theme-top",vex.defaultOptions.overlayClosesOnClick=!0,vex.dialog.buttons.YES.text="Fermer",vex.dialog.alert({message:jQuery(".newspan").html(),callback:function(){storageSupport.setLocal("kz_newsletter","1")}})):storageSupport.setLocal("kz_newsletter","1")}return{openShareDialog:a}}();return jQuery(".share").click(function(){c.openShareDialog()}),jQuery(document).ready(function(){a.setLogging(kidzou_commons_jsvars.cfg_debug_mode),b.bindView()}),{dialogs:c}}();